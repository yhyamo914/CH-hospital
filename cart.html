<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚ | Ù…ØªØ¬Ø± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
    --primary:#4361ee;
    --success:#2a9d8f;
    --warning:#f4a261;
    --error:#e63946;
    --dark:#212529;
    --light:#f4f6f9;
}
body{
    font-family:'Segoe UI',Tahoma;
    background:var(--light);
    margin:0 0 80px 0; /* Ù…Ø³Ø§Ø­Ø© Ø£Ø³ÙÙ„ Ù„Ù„Ù€ Bottom Nav */
}
.navbar{
    background:white;
    box-shadow:0 2px 15px rgba(0,0,0,.1);
    position:sticky;
    top:0;
    z-index:1000;
}
.navbar .container{
    max-width:1100px;
    margin:auto;
    padding:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.logo{
    font-size:22px;
    font-weight:500;
    color:var(--primary);
    text-decoration:none;
}
.nav-links{
    list-style:none;
    display:flex;
    gap:15px;
}
.nav-links a{
    text-decoration:none;
    color:#333;
    padding:8px 14px;
    border-radius:8px;
}
.nav-links a:hover{
    background:var(--primary);
    color:white;
}
.btn{
    background:var(--primary);
    color:white !important;
}
.cart-container{
    max-width:900px;
    margin:40px auto 80px;
    background:white;
    border-radius:15px;
    padding:25px;
    box-shadow:0 10px 25px rgba(0,0,0,.1);
    overflow-x:auto;
}
.cart-title{
    text-align:center;
    color:var(--primary);
    margin-bottom:30px;
}
.cart-item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:15px 0;
    border-bottom:1px solid #eee;
    transition:all 0.3s ease;
}
.cart-info{
    flex:1;
    display:flex;
    align-items:center;
    gap:15px;
}
.cart-info img{
    width:80px;
    height:80px;
    object-fit:cover;
    border-radius:8px;
}
.cart-info h4{
    margin:0 0 5px;
}
.cart-info p{
    margin:0;
    color:#666;
}
.remove-btn{
    background:var(--error);
    border:none;
    color:white;
    padding:6px 12px;
    border-radius:6px;
    cursor:pointer;
}
.total{
    margin-top:25px;
    font-size:20px;
    font-weight:bold;
    text-align:left;
}
.cart-actions{
    display:flex;
    justify-content:space-between;
    margin-top:20px;
}
.cart-actions a,
.cart-actions button{
    padding:12px 20px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    text-decoration:none;
    font-weight:600;
}
.back{
    background:#6c757d;
    color:white;
}
.checkout{
    background:var(--success);
    color:white;
}
.empty{
    text-align:center;
    color:#999;
    padding:40px;
}
.quantity-controls{
    display:flex;
    align-items:center;
    gap:6px;
    margin-top:5px;
}
.quantity-controls button{
    width:24px; height:24px; border:none; border-radius:4px;
    cursor:pointer; font-weight:bold; background:var(--primary); color:white;
}

/* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
#checkoutForm{
    display:none;
    margin-top:20px;
    padding:20px;
    background:#f1f1f1;
    border-radius:10px;
}
#checkoutForm input, #checkoutForm textarea{
    width:100%;
    margin-bottom:10px;
    padding:10px;
    border-radius:6px;
    border:1px solid #ccc;
}
#checkoutForm button{
    width:100%;
    background:var(--success);
    color:white;
    padding:12px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
}

/* toast notifications */
#toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.toast-message {
    color:white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    opacity: 0;
    animation: fadein 0.5s forwards, fadeout 0.5s 2.5s forwards;
}
.toast-success{ background:var(--success); }
.toast-warning{ background:var(--warning); }
.toast-error{ background:var(--error); }
@keyframes fadein {
    from {opacity:0; transform:translateY(20px);}
    to {opacity:1; transform:translateY(0);}
}
@keyframes fadeout {
    from {opacity:1; transform:translateY(0);}
    to {opacity:0; transform:translateY(20px);}
}

/* Bottom Nav */
.bottom-nav{
    display:flex;
    position:fixed;
    bottom:0;
    width:100%;
    background:#fff;
    justify-content:space-around;
    padding:6px 0;
    box-shadow:0 -2px 12px rgba(0,0,0,.1);
    z-index:1000;
}
.bottom-nav a{
    text-decoration:none;
    color:#333;
    font-size:18px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    position:relative;
    padding:8px 0;
}
.bottom-nav a i{
    font-size:22px;
    margin-bottom:2px;
}
.cart-badge{
    position:absolute;
    top:0;
    right:6px;
    background:red;
    color:#fff;
    font-size:10px;
    padding:1px 6px;
    border-radius:50%;
    display:none;
}
@media(max-width:600px){
    .cart-item{
        flex-direction:column;
        align-items:flex-start;
        gap:10px;
    }
    .cart-actions{
        flex-direction:column;
        gap:10px;
    }
    .quantity-controls{
        justify-content:flex-start;
    }
}
@media(min-width:1025px){
    .bottom-nav{display:none;}
}

/* SOCIAL FLOATING ICONS */
.social-float{
    position:fixed;
    top:50%;
    left:15px;
    transform:translateY(-50%);
    display:flex;
    flex-direction:column;
    gap:12px;
    z-index:2000;
}

.social{
    width:45px;
    height:45px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:50%;
    color:#fff;
    font-size:20px;
    text-decoration:none;
    box-shadow:0 8px 20px rgba(0,0,0,.25);
    transition:.3s ease;
}

.social:hover{
    transform:scale(1.15);
}

/* Facebook */
.social.facebook{
    background:#1877f2;
}

/* TikTok */
.social.tiktok{
    background:#000;
    position:relative;
}
.social.tiktok::after{
    content:"";
    position:absolute;
    inset:-2px;
    border-radius:50%;
    background:linear-gradient(45deg,#25F4EE,#FE2C55);
    z-index:-1;
}

/* Instagram */
.social.instagram{
    background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af,#515bd4);
}

/* Mobile size */
@media(max-width:768px){
    .social{
        width:40px;
        height:40px;
        font-size:18px;
    }
}

</style>
</head>
<body>

<nav class="navbar">
  <div class="container">
    <a href="index.html" class="logo">CH-hospital </a>
    <ul class="nav-links">
      <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a href="products.html">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
      <li><a href="cart.html" class="btn"><i class="fas fa-shopping-cart"></i> </a></li>
    </ul>
  </div>
</nav>

<div class="cart-container">
    <h2 class="cart-title">ğŸ›’ Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
    <div id="cart"></div>

    <form id="checkoutForm">
        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>
        <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
        <textarea id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required></textarea>
        <button type="submit">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
    </form>
</div>

<div id="toast"></div>


<script>
firebase.initializeApp({
  apiKey: "AIzaSyCxZZ4dYqrxJ_rlMcXmZhx5Kwg_ZeYnYog",
  authDomain: "computer-store-4c946.firebaseapp.com",
  projectId: "computer-store-4c946",
});
const auth = firebase.auth();
const db = firebase.firestore();

function showToast(msg,type='success'){
    const toast=document.createElement("div");
    toast.className=`toast-message toast-${type}`;
    toast.textContent=msg;
    document.getElementById("toast").appendChild(toast);
    setTimeout(()=>toast.remove(),3000);
}

async function renderCart(){
    const box=document.getElementById("cart");
    const form=document.getElementById("checkoutForm");
    let total=0;
    box.innerHTML="";
    form.style.display="none";

    const user=auth.currentUser;
    if(!user){
        box.innerHTML=`<p class="empty">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¹Ø±Ø¨Ø©</p>
                       <a href="login.html" class="back">â¬… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>`;
        return;
    }

    const snap = await db.collection("users").doc(user.uid).collection("cart").get();
    if(snap.empty){
        box.innerHTML=`<p class="empty">Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©</p>`;
        updateCartBadge();
        return;
    }

    let items = [];
    snap.forEach(d=>items.push({id:d.id,...d.data()}));

    items.forEach(i=>{
        total += i.price*(i.quantity||1);
        const div=document.createElement("div");
        div.className="cart-item";
        div.innerHTML=`
            <div class="cart-info">
                <img src="${i.image||'https://via.placeholder.com/80'}">
                <div>
                    <h4>${i.name}</h4>
                    <p>${i.price} Ø¬.Ù… Ã— ${i.quantity||1}</p>
                    <div class="quantity-controls">
                        <button onclick="updateQuantity('${i.id}',-1)">-</button>
                        <span>${i.quantity||1}</span>
                        <button onclick="updateQuantity('${i.id}',1)">+</button>
                    </div>
                </div>
            </div>
            <button class="remove-btn" onclick="removeItem('${i.id}')">Ø­Ø°Ù</button>
        `;
        box.appendChild(div);
    });

    box.innerHTML += `<div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø¬.Ù…</div>
                      <div class="cart-actions">
                        <a href="products.html" class="back">â¬… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚</a>
                        <button class="checkout" onclick="showCheckoutForm()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
                      </div>`;

    updateCartBadge();
}

async function updateQuantity(id, delta){
    const u = auth.currentUser;
    const docRef = db.collection("users").doc(u.uid).collection("cart").doc(id);
    const doc = await docRef.get();
    if(!doc.exists) return;
    const q=(doc.data().quantity||1)+delta;
    if(q<1) return removeItem(id);
    await docRef.update({quantity:q});
    renderCart();
    showToast(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ù„Ù‰ ${q}`,'success');
}

async function removeItem(id){
    const u = auth.currentUser;
    await db.collection("users").doc(u.uid).collection("cart").doc(id).delete();
    renderCart();
    showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø¹Ø±Ø¨Ø©",'error');
}

function showCheckoutForm(){
    document.getElementById("checkoutForm").style.display="block";
}

document.getElementById("checkoutForm").addEventListener("submit",async e=>{
    e.preventDefault();
    const user = auth.currentUser;
    if(!user) return;

    const phone=document.getElementById("phone").value||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    const address=document.getElementById("address").value||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

    const cartSnap = await db.collection("users").doc(user.uid).collection("cart").get();
    if(cartSnap.empty){
        showToast("Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©!","warning");
        renderCart();
        return;
    }

    let cartItems=[]; let total=0;
    cartSnap.forEach(d=>{
        const data=d.data();
        cartItems.push({
            id:d.id,
            name:data.name,
            price:data.price,
            qty:data.quantity||1,
            image:data.image||''
        });
        total += data.price*(data.quantity||1);
    });

    const customerEmail=user.email||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    let customerName=user.displayName||customerEmail.split('@')[0];

    await db.collection("orders").add({
        name:customerName,
        email:customerEmail,
        phone,
        address,
        items:cartItems,
        total,
        status:'pending',
        createdAt:Date.now()
    });

    showToast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡.",'success');
    cartSnap.forEach(d=>d.ref.delete());
    renderCart();
});

async function updateCartBadge(){
    const user = auth.currentUser;
    const badge = document.getElementById("cartCount");
    if(!user){
        badge.style.display="none";
        return;
    }
    const snap = await db.collection("users").doc(user.uid).collection("cart").get();
    const count = snap.size;
    if(count>0){
        badge.textContent = count;
        badge.style.display="block";
    } else {
        badge.style.display="none";
    }
}

auth.onAuthStateChanged(async user=>{
    renderCart();
    const profileM = document.getElementById("profileNav");
    const adminM = document.getElementById("adminNav");

    if(user){
        profileM.style.display="flex";
        const u = await db.collection("users").doc(user.uid).get();
        if(u.exists && u.data().role==="admin"){
            adminM.style.display="flex";
        }
    } else {
        profileM.style.display="none";
        adminM.style.display="none";
    }
});
</script>

<!-- Bottom Nav -->
<div class="bottom-nav">
  <a href="index.html"><i class="fas fa-home"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
  <a href="products.html"><i class="fas fa-laptop"></i><span>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span></a>
  <a href="cart.html"><i class="fas fa-shopping-cart"></i><span>Ø§Ù„Ø¹Ø±Ø¨Ø©</span><span id="cartCount" class="cart-badge">0</span></a>
  <a href="profile.html" id="profileNav" style="display:none"><i class="fas fa-user"></i><span>Ø­Ø³Ø§Ø¨ÙŠ</span></a>
  <a href="admin.html" id="adminNav" style="display:none"><i class="fas fa-cogs"></i><span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></a>
</div>
<!-- SOCIAL FLOATING -->
<div class="social-float">
  <a href="https://facebook.com" target="_blank" class="social facebook">
    <i class="fab fa-facebook-f"></i>
  </a>

  <a href="https://tiktok.com" target="_blank" class="social tiktok">
    <i class="fab fa-tiktok"></i>
  </a>

  <a href="https://instagram.com" target="_blank" class="social instagram">
    <i class="fab fa-instagram"></i>
  </a>
</div>

</body>
</html>
